<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EnglishQuest ğŸ‰</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600;700&family=Spectral:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --void:#030208;--deep:#0d0819;--panel:rgba(18,11,36,.97);
  --gold:#dba84a;--gold2:#f2cf80;--goldD:#7a5518;
  --ember:#c24510;--ember2:#ff6933;
  --blood:#7a1515;--bloodL:#c03030;
  --teal:#17a890;--tealL:#22d9bc;
  --sage:#328060;--sageL:#50ab7d;
  --violet:#5c228a;
  --text:#cdbfa5;--textD:#6a5c44;
  --T:'Cinzel Decorative',cursive;--S:'Cinzel',serif;--B:'Spectral',serif;
}
html,body{background:var(--void);font-family:var(--B);color:var(--text);min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--deep)}::-webkit-scrollbar-thumb{background:var(--goldD);border-radius:3px}
#cosmos{position:fixed;inset:0;z-index:0;pointer-events:none;
  background:radial-gradient(ellipse 90% 70% at 10% -10%,rgba(92,34,138,.2) 0%,transparent 50%),
             radial-gradient(ellipse 70% 55% at 90% 110%,rgba(194,69,16,.13) 0%,transparent 50%)}
#cosmos::after{content:'';position:absolute;inset:0;
  background-image:
    radial-gradient(1.5px 1.5px at 7% 8%,rgba(219,168,74,.9) 0%,transparent 1.5px),
    radial-gradient(1px 1px at 22% 4%,rgba(255,255,255,.7) 0%,transparent 1px),
    radial-gradient(2px 2px at 63% 6%,rgba(255,255,255,.8) 0%,transparent 2px),
    radial-gradient(1.5px 1.5px at 88% 3%,rgba(255,255,255,.6) 0%,transparent 1.5px),
    radial-gradient(1px 1px at 41% 2%,rgba(219,168,74,.5) 0%,transparent 1px),
    radial-gradient(2px 2px at 73% 35%,rgba(255,255,255,.5) 0%,transparent 2px),
    radial-gradient(1.5px 1.5px at 4% 68%,rgba(219,168,74,.55) 0%,transparent 1.5px),
    radial-gradient(1px 1px at 58% 80%,rgba(255,255,255,.45) 0%,transparent 1px)}
#app{position:relative;z-index:1;min-height:100vh}
.screen{display:none}.screen.active{display:block}
nav{position:sticky;top:0;z-index:200;height:58px;padding:0 20px;
  display:flex;align-items:center;justify-content:space-between;
  background:rgba(3,2,8,.93);border-bottom:1px solid rgba(219,168,74,.15);backdrop-filter:blur(14px)}
.logo{font-family:var(--T);font-size:19px;color:var(--gold);
  text-shadow:0 0 22px rgba(219,168,74,.55);cursor:pointer;letter-spacing:1px}
.logo em{color:var(--ember2);font-style:normal}
.nav-btns{display:flex;gap:4px}
.nb{padding:6px 14px;border:1px solid transparent;border-radius:5px;
  background:transparent;color:var(--textD);font-family:var(--S);font-size:12px;cursor:pointer;transition:all .22s}
.nb:hover,.nb.on{color:var(--gold);border-color:rgba(219,168,74,.4);background:rgba(219,168,74,.08)}
.nb.adm{color:var(--teal)}.nb.adm:hover,.nb.adm.on{color:var(--tealL);border-color:rgba(23,168,144,.4);background:rgba(23,168,144,.07)}
.nav-r{display:flex;align-items:center;gap:12px}
.nav-pts{font-family:var(--S);font-size:14px;color:var(--gold)}
.nav-av{width:34px;height:34px;border-radius:50%;border:2px solid var(--goldD);display:grid;place-items:center;font-size:17px}
.pnl{background:linear-gradient(150deg,var(--panel),rgba(7,4,15,.98));
  border:1px solid rgba(219,168,74,.13);border-radius:14px;padding:20px;
  box-shadow:0 6px 36px rgba(0,0,0,.5)}
.pnl-t{font-family:var(--S);font-size:11px;font-weight:700;letter-spacing:2px;
  text-transform:uppercase;color:var(--goldD);margin-bottom:16px;
  padding-bottom:9px;border-bottom:1px solid rgba(219,168,74,.1)}
.pnl-t.tl{color:var(--teal);border-bottom-color:rgba(23,168,144,.13)}
.divL{height:1px;background:rgba(219,168,74,.09);margin:13px 0}
.bw{margin-bottom:3px}
.bl{display:flex;justify-content:space-between;font-family:var(--S);font-size:10px;color:var(--textD);margin-bottom:4px}
.bt{height:7px;background:rgba(255,255,255,.07);border-radius:4px;overflow:hidden}
.bf{height:100%;border-radius:4px;transition:width .6s cubic-bezier(.4,0,.2,1)}
.hp{background:linear-gradient(90deg,var(--blood),var(--ember2))}
.xp{background:linear-gradient(90deg,var(--sage),var(--sageL))}
.prg{background:linear-gradient(90deg,var(--violet),var(--gold))}
.nmy{background:linear-gradient(90deg,var(--violet),#d850f0)}
.bgold{padding:12px 32px;background:linear-gradient(135deg,var(--goldD),var(--gold));
  border:none;border-radius:6px;color:var(--void);font-family:var(--T);font-size:14px;
  cursor:pointer;transition:all .28s;box-shadow:0 5px 22px rgba(219,168,74,.25)}
.bgold:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 9px 28px rgba(219,168,74,.4)}
.bgold:disabled{opacity:.35;cursor:not-allowed}
.bemb{padding:12px 28px;background:linear-gradient(135deg,var(--blood),var(--ember));
  border:none;border-radius:6px;color:#fff;font-family:var(--T);font-size:13px;
  cursor:pointer;transition:all .28s}
.bemb:hover{transform:translateY(-2px)}
.bteal{padding:12px 28px;background:linear-gradient(135deg,#0d6e5d,var(--teal));
  border:none;border-radius:6px;color:var(--void);font-family:var(--T);font-size:13px;
  cursor:pointer;transition:all .28s}
.bteal:hover{transform:translateY(-2px)}

/* LOGIN */
#s-login{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px}
.drag{font-size:96px;margin-bottom:26px;line-height:1;
  filter:drop-shadow(0 0 40px rgba(194,69,16,.75));
  animation:dragF 3.8s ease-in-out infinite}
@keyframes dragF{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-16px) scale(1.05)}}
.login-T{font-family:var(--T);font-size:clamp(40px,8vw,76px);color:var(--gold);text-align:center;
  text-shadow:0 0 50px rgba(219,168,74,.5);line-height:1.1;margin-bottom:8px}
.login-T em{color:var(--ember2);font-style:normal}
.login-sub{font-family:var(--S);font-size:12px;letter-spacing:4px;color:var(--textD);
  text-transform:uppercase;text-align:center;margin-bottom:48px}
.login-card{background:linear-gradient(145deg,rgba(19,12,38,.98),rgba(7,4,15,.98));
  border:1px solid rgba(219,168,74,.22);border-radius:20px;padding:44px 40px;
  width:100%;max-width:400px;text-align:center;
  box-shadow:0 0 70px rgba(92,34,138,.2),0 36px 72px rgba(0,0,0,.6)}
.login-card h2{font-family:var(--T);color:var(--gold);font-size:22px;margin-bottom:8px}
.login-card p{color:var(--textD);font-size:14px;margin-bottom:32px;font-style:italic}
.gsig{display:flex;align-items:center;justify-content:center;gap:12px;
  width:100%;padding:15px 22px;border-radius:10px;
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.15);
  color:var(--text);font-size:15px;font-family:var(--B);cursor:pointer;transition:all .3s}
.gsig:hover{background:rgba(219,168,74,.07);border-color:rgba(219,168,74,.4)}
.feats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:28px}
.feat{background:rgba(255,255,255,.03);border:1px solid rgba(219,168,74,.09);
  border-radius:8px;padding:12px 10px;font-size:12px;color:var(--textD);text-align:center}
.feat .fi{display:block;font-size:18px;margin-bottom:5px}

/* CHAR SELECT */
#s-char{padding:36px 28px;max-width:1060px;margin:0 auto}
.pgT{font-family:var(--T);font-size:32px;color:var(--gold);text-align:center;margin-bottom:7px}
.pgS{font-family:var(--S);font-size:12px;letter-spacing:3px;color:var(--textD);text-transform:uppercase;text-align:center;margin-bottom:42px}
.cgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;margin-bottom:36px}
.cc{background:linear-gradient(160deg,rgba(19,12,38,.92),rgba(7,4,15,.96));
  border:2px solid rgba(219,168,74,.11);border-radius:14px;
  padding:28px 20px;text-align:center;cursor:pointer;transition:all .38s;position:relative}
.cc:hover{border-color:rgba(219,168,74,.42);transform:translateY(-5px);box-shadow:0 22px 56px rgba(0,0,0,.6)}
.cc.sel{border-color:var(--gold);box-shadow:0 0 0 3px rgba(219,168,74,.14)}
.cc-badge{position:absolute;top:10px;left:10px;background:var(--gold);
  color:var(--void);font-family:var(--S);font-size:9px;font-weight:700;padding:2px 8px;border-radius:3px}
.cc-icon{font-size:66px;display:block;margin-bottom:12px;transition:transform .38s}
.cc:hover .cc-icon{transform:scale(1.08)}
.cc-name{font-family:var(--T);font-size:19px;color:var(--gold);margin-bottom:3px}
.cc-cls{font-family:var(--S);font-size:10px;color:var(--ember2);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px}
.cc-desc{color:var(--textD);font-size:13px;line-height:1.5;font-style:italic;margin-bottom:16px}
.cc-stats{display:flex;flex-direction:column;gap:5px}
.csr{display:flex;align-items:center;gap:7px}
.csl{font-family:var(--S);font-size:9px;color:var(--textD);width:48px;text-align:right}
.csb{flex:1;height:3px;background:rgba(255,255,255,.08);border-radius:2px;overflow:hidden}
.csf{height:100%;border-radius:2px}

/* GAME */
#s-game{padding:20px 24px;max-width:1260px;margin:0 auto}
.glay{display:grid;grid-template-columns:248px 1fr 248px;gap:18px;align-items:start}
.hero-c{text-align:center;margin-bottom:18px}
.hero-ic{font-size:62px;display:block;margin-bottom:8px;animation:hGlow 3s ease-in-out infinite}
@keyframes hGlow{0%,100%{filter:drop-shadow(0 0 18px rgba(219,168,74,.4))}50%{filter:drop-shadow(0 0 28px rgba(219,168,74,.68))}}
.hero-n{font-family:var(--T);color:var(--gold);font-size:18px}
.hero-k{font-family:var(--S);font-size:10px;color:var(--ember2);letter-spacing:2px}
.kv{display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;font-family:var(--S);font-size:12px}
.kvk{color:var(--textD)}.kvv{color:var(--gold)}.kvv.g{color:var(--sageL)}
.pwraps{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
.pchip{padding:4px 10px;border-radius:4px;border:1px solid;font-family:var(--S);font-size:10px}
.arena{background:linear-gradient(170deg,rgba(19,12,38,.96),rgba(3,2,8,.99));
  border:1px solid rgba(219,168,74,.16);border-radius:14px;padding:28px 24px;
  display:flex;flex-direction:column;align-items:center;position:relative;overflow:hidden}
.arena::before{content:'';position:absolute;inset:0;pointer-events:none;
  background:radial-gradient(ellipse 75% 45% at 50% 25%,rgba(194,69,16,.05) 0%,transparent 65%)}
.arT{font-family:var(--T);font-size:20px;color:var(--gold);letter-spacing:2px;margin-bottom:5px}
.arM{font-family:var(--S);font-size:10px;color:var(--ember2);letter-spacing:3px;text-transform:uppercase;margin-bottom:24px}
.fts{display:flex;align-items:center;justify-content:center;gap:28px;margin-bottom:24px;width:100%}
.ft{display:flex;flex-direction:column;align-items:center;gap:7px;flex:1;max-width:180px}
.ftic{font-size:80px;animation:fE 2.2s ease-in-out infinite;filter:drop-shadow(0 0 18px rgba(194,69,16,.5))}
.ftic.pl{animation:fP 2.8s ease-in-out infinite;filter:drop-shadow(0 0 18px rgba(219,168,74,.45))}
@keyframes fE{0%,100%{transform:translateY(0) rotate(-3deg)}50%{transform:translateY(-9px) rotate(3deg)}}
@keyframes fP{0%,100%{transform:translateY(0) rotate(1.5deg)}50%{transform:translateY(-6px) rotate(-1.5deg)}}
.ftnm{font-family:var(--S);color:var(--text);font-size:12px;font-weight:700}
.ftbr{width:128px}
.vs{font-family:var(--T);font-size:30px;color:var(--ember2);text-shadow:0 0 18px var(--ember);flex-shrink:0}
.blog{background:rgba(0,0,0,.42);border:1px solid rgba(219,168,74,.09);
  border-radius:10px;padding:14px 18px;width:100%;margin-bottom:20px;min-height:68px}
.blogt{font-size:14px;line-height:1.65;color:var(--text);font-style:italic}
.blogt .g{color:var(--gold);font-style:normal}.blogt .f{color:var(--ember2);font-style:normal}.blogt .gr{color:var(--sageL);font-style:normal}
.abtns{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;justify-content:center}
.prgsec{width:100%}
.prgl{display:flex;justify-content:space-between;font-family:var(--S);font-size:10px;color:var(--textD);margin-bottom:7px}
.prgnodes{display:flex;justify-content:space-between;margin-top:9px}
.pnode{width:16px;height:16px;border-radius:50%;border:2px solid rgba(219,168,74,.18);
  background:var(--void);display:grid;place-items:center;font-size:8px;transition:all .4s}
.pnode.done{border-color:var(--gold);background:var(--goldD);color:var(--void)}
.pnode.now{border-color:var(--ember2);animation:pls 1.2s infinite}
@keyframes pls{0%,100%{box-shadow:0 0 10px var(--ember)}50%{box-shadow:0 0 20px var(--ember2)}}
.qo{display:flex;align-items:flex-start;gap:8px;margin-bottom:11px}
.qo-ck{font-size:15px;flex-shrink:0;margin-top:1px}
.qo-tx{font-size:12px;line-height:1.45}
.qo-tx.done{color:var(--sageL)}.qo-tx.pend{color:var(--textD)}
.rwbx{text-align:center;padding:16px 0}
.rwic{font-size:48px;margin-bottom:6px;display:block}
.rwnm{font-family:var(--T);color:var(--gold);font-size:13px;margin-bottom:3px}
.rwdist{color:var(--textD);font-size:11px;font-style:italic}

/* MODAL */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:600;
  display:none;align-items:center;justify-content:center;padding:18px;backdrop-filter:blur(12px)}
.overlay.open{display:flex}
.modal{background:linear-gradient(145deg,rgba(19,12,38,.99),rgba(7,4,15,.99));
  border:1px solid rgba(219,168,74,.26);border-radius:20px;padding:36px 40px;
  width:100%;max-width:680px;max-height:92vh;overflow-y:auto}
.mhead{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:26px}
.mtype{font-family:var(--S);font-size:11px;letter-spacing:3px;text-transform:uppercase;color:var(--ember2)}
.mmeta{font-family:var(--S);font-size:11px;color:var(--textD);margin-top:3px}
.mclose{width:30px;height:30px;border:1px solid rgba(219,168,74,.22);border-radius:5px;
  background:transparent;color:var(--textD);cursor:pointer;font-size:15px}
.mclose:hover{border-color:var(--gold);color:var(--gold)}
.passage{background:rgba(0,0,0,.32);border:1px solid rgba(219,168,74,.1);border-radius:10px;padding:20px 22px;margin-bottom:24px}
.pasT{font-family:var(--T);color:var(--gold);font-size:17px;margin-bottom:10px}
.pasTx{font-size:15px;line-height:1.8}
.exQ{font-size:20px;color:var(--text);line-height:1.5;margin-bottom:26px;font-style:italic}
.exQ strong{color:var(--gold2);font-style:normal}
.opts{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}
.opt{padding:14px 17px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.11);
  border-radius:10px;color:var(--text);font-size:14px;cursor:pointer;
  transition:all .28s;font-family:var(--B);text-align:right;width:100%}
.opt:hover:not([disabled]){background:rgba(219,168,74,.07);border-color:rgba(219,168,74,.42);color:var(--gold)}
.opt.cor{background:rgba(50,128,96,.17)!important;border-color:var(--sageL)!important;color:var(--sageL)!important}
.opt.wrg{background:rgba(122,21,21,.17)!important;border-color:var(--bloodL)!important;color:var(--bloodL)!important}
.fbk{padding:15px 18px;border-radius:10px;margin-bottom:20px;font-size:14px;line-height:1.6}
.fbk.cor{background:rgba(50,128,96,.1);border:1px solid var(--sageL);color:var(--sageL)}
.fbk.wrg{background:rgba(122,21,21,.1);border:1px solid var(--bloodL);color:var(--bloodL)}
.ldg{text-align:center;padding:52px 36px}
.ldgic{font-size:68px;animation:spin 4s linear infinite;display:block;margin-bottom:18px}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
.ldgT{font-family:var(--T);color:var(--gold);font-size:20px;margin-bottom:10px}
.ldgS{color:var(--textD);font-style:italic;font-size:14px}

/* SHOP */
#s-shop{padding:28px 24px;max-width:1180px;margin:0 auto}
.shop-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:26px;flex-wrap:wrap;gap:12px}
.shop-cats{display:flex;gap:8px}
.scat{padding:8px 20px;border:1px solid rgba(219,168,74,.17);border-radius:5px;
  background:transparent;color:var(--textD);font-family:var(--S);font-size:12px;cursor:pointer;transition:all .22s}
.scat:hover,.scat.on{border-color:var(--gold);color:var(--gold);background:rgba(219,168,74,.07)}
.igrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:16px}
.si{background:linear-gradient(145deg,rgba(19,12,38,.92),rgba(7,4,15,.96));
  border:1px solid rgba(219,168,74,.11);border-radius:13px;padding:22px 18px;text-align:center;transition:all .32s}
.si:hover{border-color:rgba(219,168,74,.38);transform:translateY(-5px)}
.si-ic{font-size:50px;margin-bottom:10px;display:block}
.si-nm{font-family:var(--S);font-weight:700;color:var(--text);font-size:14px;margin-bottom:5px}
.si-ds{font-size:12px;color:var(--textD);line-height:1.45;margin-bottom:12px;font-style:italic}
.si-pr{font-family:var(--S);color:var(--gold);font-size:14px;margin-bottom:10px}
.sib{width:100%;padding:8px;border:1px solid;border-radius:5px;font-family:var(--S);
  font-size:11px;letter-spacing:1px;cursor:pointer;transition:all .22s;text-transform:uppercase}
.sib.can{border-color:rgba(219,168,74,.42);background:rgba(219,168,74,.07);color:var(--gold)}
.sib.can:hover{background:rgba(219,168,74,.15)}
.sib.own{border-color:rgba(80,171,125,.42);background:rgba(80,171,125,.07);color:var(--sageL);cursor:default}
.sib.no{border-color:rgba(255,255,255,.08);color:var(--textD);cursor:default;opacity:.45}

/* ADMIN */
#s-admin{padding:28px 24px;max-width:1380px;margin:0 auto}
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:28px}
.kpi{background:linear-gradient(145deg,rgba(19,12,38,.92),rgba(7,4,15,.96));border:1px solid rgba(23,168,144,.16);border-radius:13px;padding:20px}
.kpi-v{font-family:var(--T);font-size:38px;color:var(--tealL);line-height:1;margin-bottom:6px}
.kpi-l{font-family:var(--S);font-size:10px;color:var(--textD);letter-spacing:2px;text-transform:uppercase}
.atabs{display:flex;gap:6px;margin-bottom:22px}
.at{padding:8px 20px;border:1px solid rgba(23,168,144,.16);border-radius:5px;
  background:transparent;color:var(--textD);font-family:var(--S);font-size:11px;letter-spacing:1px;cursor:pointer;transition:all .22s;text-transform:uppercase}
.at:hover,.at.on{border-color:var(--teal);color:var(--tealL);background:rgba(23,168,144,.07)}
.dtable{width:100%;border-collapse:collapse}
.dtable th{font-family:var(--S);font-size:10px;color:var(--teal);letter-spacing:2px;text-transform:uppercase;padding:10px 14px;text-align:right;border-bottom:1px solid rgba(23,168,144,.16);white-space:nowrap}
.dtable td{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.04);font-size:13px}
.dtable tr:hover td{background:rgba(23,168,144,.03)}
.acc{display:inline-block;padding:2px 9px;border-radius:3px;font-size:11px;font-family:var(--S)}
.acc.hi{background:rgba(50,128,96,.18);color:var(--sageL)}.acc.md{background:rgba(219,168,74,.14);color:var(--gold)}.acc.lo{background:rgba(122,21,21,.18);color:var(--bloodL)}
.tbtn{padding:4px 11px;border-radius:3px;font-family:var(--S);font-size:10px;letter-spacing:1px;cursor:pointer;transition:all .18s;text-transform:uppercase}
.tbtn.vw{border:1px solid rgba(219,168,74,.32);background:transparent;color:var(--gold)}.tbtn.vw:hover{background:rgba(219,168,74,.1)}
.tbtn.rs{border:1px solid rgba(122,21,21,.35);background:transparent;color:var(--bloodL);margin-left:5px}.tbtn.rs:hover{background:rgba(122,21,21,.1)}
.tskfm{background:rgba(0,0,0,.22);border:1px solid rgba(23,168,144,.16);border-radius:13px;padding:26px;margin-bottom:18px}
label.fl{display:block;font-family:var(--S);font-size:10px;color:var(--teal);letter-spacing:2px;text-transform:uppercase;margin-bottom:7px}
input.fi,select.fs,textarea.fta{width:100%;padding:11px 15px;background:rgba(255,255,255,.04);border:1px solid rgba(23,168,144,.18);border-radius:6px;color:var(--text);font-size:14px;font-family:var(--B);transition:all .28s;direction:rtl}
input.fi:focus,select.fs:focus,textarea.fta:focus{outline:none;border-color:var(--teal)}
select.fs option{background:#07040f}
textarea.fta{height:120px;resize:vertical}
.fg{margin-bottom:18px}
.fdrop{border:2px dashed rgba(23,168,144,.22);border-radius:10px;padding:24px;text-align:center;cursor:pointer;color:var(--textD);font-size:13px;font-style:italic}
.trow{background:rgba(0,0,0,.22);border:1px solid rgba(23,168,144,.1);border-radius:10px;padding:14px 20px;display:flex;align-items:center;gap:14px;margin-bottom:10px}
.tyb{padding:3px 10px;border-radius:3px;font-family:var(--S);font-size:10px;letter-spacing:1px;text-transform:uppercase;white-space:nowrap}
.tyb.gr{background:rgba(219,168,74,.1);color:var(--gold);border:1px solid rgba(219,168,74,.22)}
.tyb.rd{background:rgba(50,128,96,.1);color:var(--sageL);border:1px solid rgba(50,128,96,.22)}
.tnm{flex:1;font-size:14px}.tmeta{font-family:var(--S);font-size:11px;color:var(--textD);white-space:nowrap}
.ainote{background:rgba(23,168,144,.06);border:1px solid rgba(23,168,144,.18);border-radius:10px;padding:16px 18px;color:var(--tealL);font-size:13px;font-family:var(--S);line-height:1.6}

/* TOAST */
#toast{position:fixed;top:70px;left:20px;z-index:900;padding:13px 20px;border-radius:10px;
  font-family:var(--S);font-size:13px;max-width:320px;box-shadow:0 7px 28px rgba(0,0,0,.6);
  display:none;animation:tIn .3s ease}
@keyframes tIn{from{transform:translateX(-70px);opacity:0}to{transform:translateX(0);opacity:1}}
#toast.gold{background:linear-gradient(135deg,rgba(19,12,38,.99),rgba(7,4,15,.99));border:1px solid var(--gold);color:var(--gold)}
#toast.green{background:linear-gradient(135deg,rgba(19,12,38,.99),rgba(7,4,15,.99));border:1px solid var(--sageL);color:var(--sageL)}
#toast.red{background:linear-gradient(135deg,rgba(19,12,38,.99),rgba(7,4,15,.99));border:1px solid var(--bloodL);color:var(--bloodL)}

/* API KEY INPUT */
.api-banner{background:rgba(219,168,74,.08);border-bottom:1px solid rgba(219,168,74,.2);
  padding:10px 20px;font-family:var(--S);font-size:12px;color:var(--gold);
  display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.api-input{flex:1;min-width:200px;padding:6px 12px;background:rgba(0,0,0,.4);
  border:1px solid rgba(219,168,74,.3);border-radius:5px;color:var(--text);font-size:12px;font-family:var(--B)}
.api-input:focus{outline:none;border-color:var(--gold)}
.api-save{padding:6px 16px;background:rgba(219,168,74,.15);border:1px solid var(--goldD);
  border-radius:5px;color:var(--gold);font-family:var(--S);font-size:11px;cursor:pointer}
.api-save:hover{background:rgba(219,168,74,.25)}

@media(max-width:980px){.glay{grid-template-columns:1fr}.kpis{grid-template-columns:1fr 1fr}.opts{grid-template-columns:1fr}}
@media(max-width:620px){.cgrid{grid-template-columns:1fr 1fr}.modal{padding:24px 18px}.fts{gap:14px}.ftic{font-size:58px}}
</style>
</head>
<body>
<div id="cosmos"></div>
<div id="toast"></div>

<div class="overlay" id="overlay">
  <div class="modal">
    <div class="mhead">
      <div><div class="mtype" id="m-type"></div><div class="mmeta" id="m-meta"></div></div>
      <button class="mclose" onclick="closeModal()">âœ•</button>
    </div>
    <div id="m-body"></div>
  </div>
</div>

<div id="app">
  <div id="s-login" class="screen active">
    <div class="drag">ğŸ‰</div>
    <h1 class="login-T">English<em>Quest</em></h1>
    <p class="login-sub">×©×œ×•×˜ ×‘×©×¤×” Â· ×”×¨×•×¡ ××ª ×”×“×¨×§×•×Ÿ Â· ×›×‘×•×© ××ª ×”×’×‘×™×¢</p>
    <div class="login-card">
      <h2>×”×ª×—×œ/×™ ××ª ××¡×¢×š</h2>
      <p>×œ×—×¥/×™ ×›×“×™ ×œ×”×™×›× ×¡ ×œ×××œ×›×”</p>
      <button class="gsig" onclick="doLogin()">
        <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.6 20H24v8h11.3C33.7 33.6 29.3 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3 0 5.7 1.1 7.8 2.9l5.7-5.7C34.1 6.5 29.3 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20c11 0 20-9 20-20 0-1.3-.1-2.7-.4-4z"/><path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.5 16 19 13 24 13c3 0 5.7 1.1 7.8 2.9l5.7-5.7C34.1 6.5 29.3 4 24 4 16.3 4 9.7 8.4 6.3 14.7z"/><path fill="#4CAF50" d="M24 44c5.2 0 9.9-2 13.4-5.2l-6.2-5.2C29.3 35.3 26.8 36 24 36c-5.2 0-9.7-3.3-11.3-8L6 33.1C9.4 39.6 16.2 44 24 44z"/><path fill="#1976D2" d="M43.6 20H24v8h11.3c-.8 2.3-2.3 4.3-4.2 5.6l6.2 5.2C41 35.3 44 30.1 44 24c0-1.3-.1-2.7-.4-4z"/></svg>
        ×›× ×¡/×™ ×œ××©×—×§
      </button>
      <div class="feats">
        <div class="feat"><span class="fi">âš”ï¸</span>×§×¨×‘ ×“×¨×§×•× ×™×</div>
        <div class="feat"><span class="fi">ğŸ“š</span>×ª×¨×’×•×œ ×× ×’×œ×™×ª</div>
        <div class="feat"><span class="fi">ğŸª</span>×—× ×•×ª ×›×•×—×•×ª</div>
        <div class="feat"><span class="fi">ğŸ†</span>×’×‘×™×¢ ×§×“×•×©</div>
      </div>
    </div>
  </div>

  <div id="s-char" class="screen">
    <nav><div class="logo">English<em>Quest</em></div><div></div><div></div></nav>
    <div style="padding:36px 28px;max-width:1060px;margin:0 auto">
      <h1 class="pgT">×‘×—×¨/×™ ××ª ×”××œ×•×£/×ª ×©×œ×š</h1>
      <p class="pgS">×’×™×‘×•×¨ ×–×” ×™×œ×—× ×‘×“×¨×§×•× ×™× ×•×™×©××£ ×œ×’×‘×™×¢ ×”×§×“×•×© ×‘×©××š</p>
      <div class="cgrid" id="chars-grid"></div>
      <div style="text-align:center"><button class="bgold" id="start-btn" disabled onclick="doStart()">×›× ×¡/×™ ×œ×××œ×›×” â†’</button></div>
    </div>
  </div>

  <div id="s-game" class="screen">
    <nav>
      <div class="logo" onclick="goTo('game')">English<em>Quest</em></div>
      <div class="nav-btns">
        <button class="nb on" onclick="goTo('game')">âš”ï¸ ××¡×¢</button>
        <button class="nb" onclick="goTo('shop')">ğŸª ×—× ×•×ª</button>
        <button class="nb adm" onclick="goTo('admin')">âš™ï¸ × ×™×”×•×œ</button>
      </div>
      <div class="nav-r">
        <div class="nav-pts" id="nav-pts">â­ 840</div>
        <div class="nav-av" id="nav-av">ğŸ§™</div>
      </div>
    </nav>
    <div class="api-banner">
      <span>ğŸ”‘ Claude API Key:</span>
      <input class="api-input" id="api-key-input" type="password" placeholder="sk-ant-api03-...">
      <button class="api-save" onclick="saveApiKey()">×©××•×¨</button>
      <span id="api-status" style="font-size:11px;color:var(--sageL)"></span>
    </div>
    <div style="padding:20px 24px;max-width:1260px;margin:0 auto">
      <div class="glay">
        <div class="pnl" id="player-panel"></div>
        <div class="arena" id="arena-panel"></div>
        <div class="pnl" id="quest-panel"></div>
      </div>
    </div>
  </div>

  <div id="s-shop" class="screen">
    <nav>
      <div class="logo" onclick="goTo('game')">English<em>Quest</em></div>
      <div class="nav-btns">
        <button class="nb" onclick="goTo('game')">âš”ï¸ ××¡×¢</button>
        <button class="nb on" onclick="goTo('shop')">ğŸª ×—× ×•×ª</button>
        <button class="nb adm" onclick="goTo('admin')">âš™ï¸ × ×™×”×•×œ</button>
      </div>
      <div class="nav-r"><div class="nav-pts" id="shop-pts">â­ 840</div></div>
    </nav>
    <div style="padding:28px 24px;max-width:1180px;margin:0 auto">
      <h1 class="pgT">ğŸª ×”×××›×¨ ×”××¨×§× ×™</h1>
      <p class="pgS">×”×©×ª××©/×™ ×‘× ×§×•×“×•×ª ×©×¦×‘×¨×ª ×œ×¨×›×™×©×ª ×¤×¨×™×˜×™× ××’×“×™×™×</p>
      <div class="shop-hd">
        <div class="shop-cats">
          <button class="scat on" id="cat-skins" onclick="setShopCat('skins')">ğŸ¨ ×§×•×¡××˜×™×§×”</button>
          <button class="scat" id="cat-powers" onclick="setShopCat('powers')">âš¡ ×›×•×—×•×ª</button>
        </div>
        <div style="font-family:var(--S);font-size:15px;color:var(--gold)">â­ <span id="shop-bal-num">840</span> × ×§×•×“×•×ª</div>
      </div>
      <div class="igrid" id="shop-grid"></div>
    </div>
  </div>

  <div id="s-admin" class="screen">
    <nav>
      <div class="logo" onclick="goTo('game')">English<em>Quest</em></div>
      <div class="nav-btns">
        <button class="nb" onclick="goTo('game')">âš”ï¸ ××¡×¢</button>
        <button class="nb" onclick="goTo('shop')">ğŸª ×—× ×•×ª</button>
        <button class="nb adm on" onclick="goTo('admin')">âš™ï¸ × ×™×”×•×œ</button>
      </div>
      <div></div>
    </nav>
    <div style="padding:28px 24px;max-width:1380px;margin:0 auto">
      <h1 class="pgT" style="color:var(--tealL)">âš™ï¸ ××¨×›×– ×¤×§×•×“×”</h1>
      <p class="pgS" style="color:var(--teal)">× ×”×œ/×™ ××©×™××•×ª ×•×¢×§×•×‘/×™ ××—×¨×™ ×’×™×‘×•×¨×™×</p>
      <div class="kpis">
        <div class="kpi"><div class="kpi-v">4</div><div class="kpi-l">×’×™×‘×•×¨×™× ×¤×¢×™×œ×™×</div></div>
        <div class="kpi"><div class="kpi-v">77%</div><div class="kpi-l">×“×™×•×§ ×××•×¦×¢</div></div>
        <div class="kpi"><div class="kpi-v">48</div><div class="kpi-l">×“×§×•×ª ×™×•××™×•×ª</div></div>
        <div class="kpi"><div class="kpi-v">3</div><div class="kpi-l">××©×™××•×ª ×¤×¢×™×œ×•×ª</div></div>
      </div>
      <div class="atabs">
        <button class="at on" id="at-users" onclick="setAdminTab('users')">ğŸ‘¥ ×’×™×‘×•×¨×™×</button>
        <button class="at" id="at-tasks" onclick="setAdminTab('tasks')">ğŸ“‹ ××©×™××•×ª</button>
        <button class="at" id="at-create" onclick="setAdminTab('create')">â• ××©×™××” ×—×“×©×”</button>
      </div>
      <div id="admin-content"></div>
    </div>
  </div>
</div>

<script>
const CHARS=[
  {id:"mage",emoji:"ğŸ§™",name:"××œ×“×¨×™×§",cls:"×××’×•×¡ ×§×¨×‘",desc:"×©×•×œ×˜ ×‘×œ×—×©×™× ××¨×§× ×™×™×, ×× ×™×£ ×—×¨×‘ ×•××˜×™×œ ×§×¡××™× ×‘×¢×ª ×•×‘×¢×•× ×” ××—×ª.",stats:{×›×•×—:78,×§×¡×:96,××”×™×¨×•×ª:60},c:["#dba84a","#8b4fd0"]},
  {id:"elf",emoji:"ğŸ§â€â™€ï¸",name:"×¡×™×œ××¨×”",cls:"×¨× ×’×³×¨ ×¦×œ×œ×™×",desc:"×§×©×ª×ª ××œ×¤×™×ª ×–×¨×™×–×”, × ×¢×” ×‘×™×Ÿ ×”×¦×œ×œ×™× ×•××™× ×” × ×™×ª× ×ª ×œ×ª×¤×™×¡×”.",stats:{×›×•×—:68,×§×¡×:60,××”×™×¨×•×ª:98},c:["#50ab7d","#17a890"]},
  {id:"war",emoji:"âš”ï¸",name:"×‘×¨×•×",cls:"×œ×•×¨×“ ×‘×¨×–×œ",desc:"×œ×•×—× ×‘×¨×‘×¨×™ ×©×–×¢××• ×”×¤×š ××•×ª×• ×œ×›×•×— ×˜×‘×¢×™ ×‘×œ×ª×™ × ×™×ª×Ÿ ×œ×¢×¦×™×¨×”.",stats:{×›×•×—:98,×§×¡×:35,××”×™×¨×•×ª:63},c:["#c24510","#ff6933"]},
  {id:"sorx",emoji:"ğŸ”®",name:"×–×¤×™×¨×”",cls:"×›×•×”× ×ª ×”×¨×™×§",desc:"××¤×¨×ª ××ª ××¨×§× ×”××¦×™××•×ª, ×©×•×œ×˜×ª ×‘×›×•×—×•×ª ×”××¤×œ×™× ×©×œ ×”×¨×™×§.",stats:{×›×•×—:50,×§×¡×:99,××”×™×¨×•×ª:79},c:["#5c228a","#d850f0"]},
];
const ENEMIES=[
  {name:"××™×’× ×¨××§×¡ ×”××©×¨×£",emoji:"ğŸ‰",hp:100,map:"××™×©×•×¨×™ ×”××¤×¨",lore:"×“×¨×§×•×Ÿ ×¢×ª×™×§ ×©×©×¨×£ ×©×œ×•×© ×××œ×›×•×ª. ××—×¤×© ×§×•×¨×‘×Ÿ ×—×“×©."},
  {name:"×•×¨×ª×•×œ ×”×§×¤×•×",emoji:"ğŸ¦•",hp:130,map:"×ª×”×•× ×”×§×¨×—",lore:"×œ×•×•×™×ª×Ÿ ×§×¨×— ×©× ×©×™××ª×• ××§×¤×™××” ×¦×‘××•×ª ×©×œ××™×."},
];
const SHOP_DATA={
  skins:[
    {id:"sk1",emoji:"ğŸ‘‘",name:"×›×ª×¨ ×”××’×“×•×ª",desc:"×¢×•×˜×¨ ×¨××©×• ×©×œ ×”×•×¨×’-×“×¨×§×•× ×™×",price:150},
    {id:"sk2",emoji:"ğŸ›¡ï¸",name:"××’×Ÿ ×›×•×›×‘×™×",desc:"× ×•×¦×§ ××—×•××¨ ×›×•×›×‘×™× ×©× ×¤×œ×•",price:220},
    {id:"sk3",emoji:"ğŸŒŸ",name:"×××•×¨×” ×©×œ ×ª×”×™×œ×”",desc:"×–×•×”×¨ ×–×”×•×‘ ×¢×•×˜×£ ××ª ×’×™×‘×•×¨×š",price:310},
    {id:"sk4",emoji:"ğŸ”¥",name:"×’×œ×™××ª ××©",desc:"×’×œ×™××” ×××© ×—×™×” ×©××™× ×” ×›×œ×”",price:265},
    {id:"sk5",emoji:"ğŸ’",name:"×©×¨×™×•×Ÿ ×’×‘×™×©",desc:"×©×¨×™×•×Ÿ ×™×”×œ×•× ×©××™× ×• ××ª× ×¤×¥",price:420},
    {id:"sk6",emoji:"ğŸŒ™",name:"×’×œ×™××ª ×™×¨×—",desc:"× ××¨×’×” ××§×¨× ×™ ×™×¨×— ×××©",price:375},
  ],
  powers:[
    {id:"pw1",emoji:"âš¡",name:"×’×œ×©×Ÿ ×‘×¨×§",desc:"+15 × ×–×§ ××™×™×“×™ ×›×‘×¨×§",price:200,c:"#dba84a"},
    {id:"pw2",emoji:"ğŸ§Š",name:"×›×‘×™×œ×ª ×§×¨×—",desc:"××§×¤×™× ××•×™×‘ 2 ×ª×•×¨×•×ª",price:260,c:"#17a890"},
    {id:"pw3",emoji:"ğŸ¦…",name:"×›× ×¤×™ ××™×§×¨×•×¡",desc:"×¢×£ ××¢×œ 3 ×”×ª×§×¤×•×ª",price:300,c:"#50ab7d"},
    {id:"pw4",emoji:"ğŸŒªï¸",name:"×§×¨×¢ ×¡×•×¤×”",desc:"×œ×”×‘ ××¡×ª×—×¨×¨ â€” ×¤×’×™×¢×” ××©×•×œ×©×ª",price:290,c:"#8b4fd0"},
    {id:"pw5",emoji:"ğŸŒ‹",name:"×œ×™×‘×ª ××’××”",desc:"+20 × ×–×§ ××©",price:340,c:"#ff6933"},
    {id:"pw6",emoji:"ğŸ”®",name:"×©×‘×¨ ×–××Ÿ",desc:"×”×©×‘ ×ª×©×•×‘×” ××—×ª ×©×’×•×™×” ×—×™× ×",price:420,c:"#d850f0"},
  ]
};
const USERS=[
  {name:"× ×•×¢×” ×›×”×Ÿ",email:"noa@gmail.com",min:24,tasks:12,ok:9,acc:75,pts:840},
  {name:"×™×•×¡×£ ×œ×•×™",email:"yosef@gmail.com",min:8,tasks:5,ok:3,acc:60,pts:320},
  {name:"×××™×” ×¨×•× ×Ÿ",email:"maya@gmail.com",min:45,tasks:28,ok:25,acc:89,pts:1540},
  {name:"××‘×™ ×‘×Ÿ-×“×•×“",email:"avi@gmail.com",min:0,tasks:3,ok:2,acc:67,pts:180},
];
const TASKS_DATA=[
  {type:"grammar",name:"Present Simple vs. Progressive",cnt:50,date:"15 ×™× ×•××¨"},
  {type:"reading",name:"The Amazon Rainforest",cnt:50,date:"18 ×™× ×•××¨"},
  {type:"grammar",name:"Modal Verbs: can / could / would",cnt:50,date:"22 ×™× ×•××¨"},
];
const SMP_GR=[
  {question:"She ___ to school every morning.",options:["go","goes","going","gone"],answer:"goes",explanation:"×¢× ×’×•×£ ×©×œ×™×©×™ ×™×—×™×“ (she/he/it) ×‘×”×•×•×” ×¤×©×•×˜ â€” ××•×¡×™×¤×™× â€‘s ×œ×¤×•×¢×œ."},
  {question:"They ___ playing when it started to rain.",options:["are","were","is","was"],answer:"were",explanation:"×¢×‘×¨ ××ª××©×š ×¢× they: were + verbâ€‘ing."},
  {question:"This is ___ book I have ever read.",options:["good","better","the best","best"],answer:"the best",explanation:"×¢×œ-×¢×œ: the + adjective-est. 'The best' ×”×¦×•×¨×” ×”×¢×œ-×¢×œ×™×ª ×©×œ 'good'."},
  {question:"Which sentence is correct?",options:["I have saw it.","I has seen it.","I have seen it.","I did see it."],answer:"I have seen it.",explanation:"Present perfect: have + past participle. 'Seen' ×”×™× ×¤\"×¢ ×©×œ see."},
  {question:"I ___ my homework yet.",options:["didn't finished","hasn't finished","haven't finished","don't finished"],answer:"haven't finished",explanation:"'Yet' â†’ Present perfect ×©×œ×™×œ×™: haven't + past participle."},
];
const SMP_RD=[
  {passage:{title:"The Lost City of Aerthon",text:"Deep in the Emerald Forest lay the ruins of Aerthon, a city from two thousand years ago. Its people built flying machines powered by magic crystals. When enemies stole their most dangerous weapon, the Aerthonians destroyed their own city rather than let its secrets be misused. Today, archaeologists dig through the ruins hoping to recover the lost knowledge."},question:"Why did the Aerthonians destroy their city?",options:["Enemies burned it down","To protect dangerous secrets","To build a better one","Their machines exploded"],answer:"To protect dangerous secrets",explanation:"×”×˜×§×¡×˜ ××•××¨: 'rather than let its secrets be misused'."},
  {passage:{title:"Dolphins Talk to Each Other",text:"Scientists discovered that dolphins use clicks and whistles as a kind of language. Every dolphin has a signature whistle that works like its name. When two dolphins meet, they exchange whistles to introduce themselves. Amazingly, a dolphin can remember another's whistle even after 20 years apart."},question:"What is a dolphin's signature whistle?",options:["A danger warning","Its unique name-sound","A mating call","A sound to find fish"],answer:"Its unique name-sound",explanation:"×”×˜×§×¡×˜ ××•××¨ ×©×”×©×¨×™×§×” 'works like its name' â€” ×›××• ×©× ×™×™×—×•×“×™."},
];

let G={
  char:null,selChar:null,pts:840,hp:85,eHp:72,xp:57,prog:18,eIdx:0,
  blog:"×”×“×¨×§×•×Ÿ ××™×’× ×¨××§×¡ × ×™×¢×•×¨ ××©× ×ª ×××•×ª ×©× ×™×... ×”××¡×¢ ×¢×œ ×”×’×‘×™×¢ ×”×§×“×•×© ××ª×—×™×œ!",
  owned:["pw1"],shopCat:"skins",adminTab:"users",
  exs:[],exI:0,chosen:null,showFb:false,isOk:false,loading:false,pType:"grammar",apiKey:""
};

let toastTimer;
function showToast(msg,type="gold"){
  const t=document.getElementById("toast");
  t.textContent=msg;t.className=type;t.style.display="block";
  clearTimeout(toastTimer);toastTimer=setTimeout(()=>t.style.display="none",3200);
}
function goTo(sc){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById("s-"+sc).classList.add("active");
  if(sc==="game")renderGame();
  if(sc==="shop")renderShop();
  if(sc==="admin")renderAdmin();
  window.scrollTo(0,0);
}
function saveApiKey(){
  G.apiKey=document.getElementById("api-key-input").value.trim();
  if(G.apiKey){document.getElementById("api-status").textContent="âœ… ×©××•×¨";showToast("âœ… API Key × ×©××¨!","green");}
}
function doLogin(){
  document.getElementById("s-login").classList.remove("active");
  document.getElementById("s-char").classList.add("active");
  renderChars();showToast("âœ¨ ×‘×¨×•×›×” ×”×‘××”, ×’×™×‘×•×¨×” ×××™×¦×”!");
}
function renderChars(){
  document.getElementById("chars-grid").innerHTML=CHARS.map(c=>`
    <div class="cc ${G.selChar?.id===c.id?'sel':''}" onclick="selChar('${c.id}')">
      ${G.selChar?.id===c.id?'<div class="cc-badge">âœ“ × ×‘×—×¨</div>':''}
      <span class="cc-icon">${c.emoji}</span>
      <div class="cc-name">${c.name}</div><div class="cc-cls">${c.cls}</div>
      <div class="cc-desc">${c.desc}</div>
      <div class="cc-stats">${Object.entries(c.stats).map(([k,v])=>`
        <div class="csr"><span class="csl">${k}</span>
        <div class="csb"><div class="csf" style="width:${v}%;background:linear-gradient(90deg,${c.c[0]},${c.c[1]})"></div></div>
        </div>`).join("")}</div>
    </div>`).join("");
}
function selChar(id){G.selChar=CHARS.find(c=>c.id===id);document.getElementById("start-btn").disabled=false;renderChars();}
function doStart(){if(!G.selChar)return;G.char=G.selChar;goTo("game");showToast(`âš”ï¸ ${G.char.name} ××•×›× ×” ×œ×§×¨×‘!`,"green");}

function renderGame(){
  if(!G.char)return;
  const enemy=ENEMIES[G.eIdx];
  document.getElementById("nav-pts").textContent=`â­ ${G.pts.toLocaleString()}`;
  document.getElementById("nav-av").textContent=G.char.emoji;
  const pwrs=G.owned.filter(id=>SHOP_DATA.powers.find(p=>p.id===id))
    .map(id=>{const p=SHOP_DATA.powers.find(x=>x.id===id);return `<div class="pchip" style="border-color:${p.c};color:${p.c};background:${p.c}18">${p.emoji} ${p.name.split(" ")[0]}</div>`;}).join("");
  document.getElementById("player-panel").innerHTML=`
    <div class="pnl-t">×”××œ×•×£/×ª ×©×œ×š</div>
    <div class="hero-c"><span class="hero-ic">${G.char.emoji}</span>
    <div class="hero-n">${G.char.name}</div><div class="hero-k">${G.char.cls}</div></div>
    <div class="bw"><div class="bl"><span>HP</span><span>${G.hp}/100</span></div><div class="bt"><div class="bf hp" style="width:${G.hp}%"></div></div></div>
    <div class="bw" style="margin-top:9px;margin-bottom:14px"><div class="bl"><span>XP</span><span>${G.xp}/100</span></div><div class="bt"><div class="bf xp" style="width:${G.xp}%"></div></div></div>
    <div class="divL"></div>
    <div class="kv"><span class="kvk">×¨××”</span><span class="kvv">â­ 7</span></div>
    <div class="kv"><span class="kvk">× ×§×•×“×•×ª</span><span class="kvv">ğŸ† ${G.pts.toLocaleString()}</span></div>
    <div class="kv"><span class="kvk">××¤×”</span><span class="kvv">${enemy.map}</span></div>
    <div class="kv"><span class="kvk">×¨×¦×£ ğŸ”¥</span><span class="kvv">7 ×™××™×</span></div>
    <div class="divL"></div>
    <div class="pnl-t">×›×•×—×•×ª ×¤×¢×™×œ×™×</div>
    <div class="pwraps">${pwrs||'<span style="font-size:11px;color:var(--textD);font-style:italic">××™×Ÿ ×›×•×—×•×ª â€” ×§× ×” ×‘×—× ×•×ª</span>'}</div>`;
  const nodes=Array.from({length:10},(_,i)=>{const d=G.prog>=(i+1)*5,n=G.prog>=i*5+1&&G.prog<(i+1)*5;return `<div class="pnode ${d?'done':n?'now':''}">${d?'âœ“':''}</div>`;}).join("");
  document.getElementById("arena-panel").innerHTML=`
    <div class="arT">âš”ï¸ ×”×–×™×¨×” ×”×’×“×•×œ×”</div>
    <div class="arM">××¤×” ${G.eIdx+1} Â· ${enemy.map}</div>
    <div class="fts">
      <div class="ft"><span class="ftic pl">${G.char.emoji}</span><div class="ftnm">${G.char.name}</div>
        <div class="ftbr"><div class="bl"><span>HP</span><span>${G.hp}%</span></div><div class="bt"><div class="bf hp" style="width:${G.hp}%"></div></div></div></div>
      <div class="vs">VS</div>
      <div class="ft"><span class="ftic">${enemy.emoji}</span><div class="ftnm">${enemy.name}</div>
        <div class="ftbr"><div class="bl"><span>HP</span><span>${G.eHp}%</span></div><div class="bt"><div class="bf nmy" style="width:${G.eHp}%"></div></div></div></div>
    </div>
    <div class="blog"><div class="blogt">${G.blog}</div></div>
    <div class="abtns">
      <button class="bemb" onclick="startPractice('grammar')">âš”ï¸ ×§×¨×‘ ×“×§×“×•×§</button>
      <button class="bteal" onclick="startPractice('reading')">ğŸ“– ××¡×¢ ×§×¨×™××”</button>
    </div>
    <div class="prgsec">
      <div class="prgl"><span>ğŸ—º ×”×ª×§×“××•×ª ×‘××¡×¢</span><span>${G.prog} / 50 ××ª×’×¨×™×</span></div>
      <div class="bt" style="height:9px"><div class="bf prg" style="width:${(G.prog/50)*100}%"></div></div>
      <div class="prgnodes">${nodes}</div>
    </div>`;
  document.getElementById("quest-panel").innerHTML=`
    <div class="pnl-t">×™×•××Ÿ ××¡×¢</div>
    <div style="font-size:12px;color:var(--textD);line-height:1.65;font-style:italic;margin-bottom:14px">${enemy.lore}</div>
    <div class="kv"><span class="kvk">××•×™×‘</span><span class="kvv" style="font-size:10px">${enemy.name}</span></div>
    <div class="kv"><span class="kvk">× ×•×ª×¨×•</span><span class="kvv">${50-G.prog} ××ª×’×¨×™×</span></div>
    <div class="divL"></div>
    <div class="pnl-t">×™×¢×“×™× ×™×•××™×™×</div>
    ${[{t:"×”×©×œ× 10 ×ª×¨×’×™×œ×™ ×“×§×“×•×§",d:true},{t:"×§×¨× ××¢×‘×¨ ××—×“",d:true},{t:"×¦×‘×•×¨ 200 × ×§×•×“×•×ª",d:false}].map(o=>`
      <div class="qo"><span class="qo-ck">${o.d?'âœ…':'â¬œ'}</span><span class="qo-tx ${o.d?'done':'pend'}">${o.t}</span></div>`).join("")}
    <div class="divL"></div>
    <div class="pnl-t">×¤×¨×¡ ×××ª×™×Ÿ</div>
    <div class="rwbx"><span class="rwic">ğŸ†</span><div class="rwnm">×”×’×‘×™×¢ ×”×§×“×•×©</div><div class="rwdist">${50-G.prog} ××ª×’×¨×™× ×¢×•×“...</div></div>`;
}

async function startPractice(type){
  G.pType=type;G.exI=0;G.chosen=null;G.showFb=false;G.loading=true;
  document.getElementById("m-type").textContent=type==="grammar"?"âš”ï¸ ×§×¨×‘ ×“×§×“×•×§":"ğŸ“– ××¡×¢ ×§×¨×™××”";
  document.getElementById("m-meta").textContent="";
  document.getElementById("overlay").classList.add("open");
  document.getElementById("m-body").innerHTML=`
    <div class="ldg"><span class="ldgic">ğŸ”®</span>
    <div class="ldgT">×”××•×¨×§×œ ××›×™×Ÿ ××ª ×”××ª×’×¨×™×...</div>
    <div class="ldgS">${G.apiKey?"Claude ××™×™×¦×¨ ×ª×¨×’×™×œ×™× ×—×“×©×™×":"×˜×•×¢×Ÿ ×ª×¨×’×™×œ×™× ×œ×“×•×’××”..."}</div></div>`;
  if(G.apiKey){
    try{
      const prompt=type==="grammar"
        ?`Generate 5 English grammar exercises for Hebrew-speaking children aged 9-12. Return ONLY a JSON array, no markdown: [{"question":"...","options":["A","B","C","D"],"answer":"exact option","explanation":"×”×¡×‘×¨ ×‘×¢×‘×¨×™×ª"}]`
        :`Generate 2 reading comprehension exercises for Hebrew kids aged 9-12 with short interesting passages. Return ONLY a JSON array: [{"passage":{"title":"...","text":"..."},"question":"...","options":["A","B","C","D"],"answer":"exact option","explanation":"×”×¡×‘×¨ ×‘×¢×‘×¨×™×ª"}]`;
      const res=await fetch("https://api.anthropic.com/v1/messages",{
        method:"POST",
        headers:{"Content-Type":"application/json","x-api-key":G.apiKey,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},
        body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,messages:[{role:"user",content:prompt}]})
      });
      const d=await res.json();
      const raw=(d.content?.[0]?.text||"[]").replace(/```json|```/g,"").trim();
      const parsed=JSON.parse(raw);
      G.exs=Array.isArray(parsed)&&parsed.length>0?parsed:(type==="grammar"?SMP_GR:SMP_RD);
    }catch(e){console.log(e);G.exs=type==="grammar"?SMP_GR:SMP_RD;}
  }else{
    await new Promise(r=>setTimeout(r,600));
    G.exs=type==="grammar"?SMP_GR:SMP_RD;
  }
  G.loading=false;renderExercise();
}

function renderExercise(){
  const ex=G.exs[G.exI];if(!ex)return;
  document.getElementById("m-meta").textContent=`××ª×’×¨ ${G.exI+1} ××ª×•×š ${G.exs.length} Â· ${G.prog}/50 ×”×™×•×`;
  const opts=(ex.options||[]).map((opt,i)=>{
    let cls="";
    if(G.showFb&&opt===ex.answer)cls="cor";
    else if(G.showFb&&opt===G.chosen)cls="wrg";
    return `<button class="opt ${cls}" onclick="doAnswer(${i})" ${G.showFb?'disabled':''}>${String.fromCharCode(65+i)}. ${opt}</button>`;
  }).join("");
  const fb=G.showFb?`
    <div class="fbk ${G.isOk?'cor':'wrg'}">${G.isOk?`âœ… ××¦×•×™×Ÿ! ${ex.explanation}`:`âŒ ×”×ª×©×•×‘×” ×”× ×›×•× ×”: "${ex.answer}". ${ex.explanation}`}</div>
    <button class="bgold" style="width:100%" onclick="doNext()">${G.exI+1>=G.exs.length?"ğŸ† ×¡×™×™× ××ª ×”×¡×©×Ÿ":"×”××ª×’×¨ ×”×‘× â†"}</button>`:"";
  document.getElementById("m-body").innerHTML=`
    ${ex.passage?`<div class="passage"><div class="pasT">ğŸ“– ${ex.passage.title}</div><div class="pasTx">${ex.passage.text}</div></div>`:""}
    <div class="exQ">${ex.question.replace(/___/g,"<strong>___</strong>")}</div>
    <div class="opts">${opts}</div>${fb}`;
}

function doAnswer(i){
  if(G.showFb)return;
  const ex=G.exs[G.exI];const opt=ex.options[i];const ok=opt===ex.answer;
  G.chosen=opt;G.showFb=true;G.isOk=ok;
  if(ok){
    G.pts+=30;G.xp=Math.min(100,G.xp+8);G.prog=Math.min(50,G.prog+1);G.eHp=Math.max(0,G.eHp-5);
    const logs=[`âš”ï¸ <span class="g">${G.char.name}</span> ×¢× ×”/×” × ×›×•×Ÿ! ×”×“×¨×§×•×Ÿ ××§×‘×œ <span class="f">-5 HP</span>!`,`âœ¨ <span class="gr">××¦×•×™×Ÿ!</span> +30 × ×§×•×“×•×ª!`,`ğŸŒŸ ×”×™×“×¢ ×©×œ <span class="g">${G.char.name}</span> ×¤×•×’×¢ ×›×—×¨×‘ ×—×“×”!`];
    G.blog=logs[Math.floor(Math.random()*3)];
  }else{
    G.hp=Math.max(0,G.hp-7);
    G.blog=`ğŸ‰ <span class="f">×”×“×¨×§×•×Ÿ</span> × ×•×©×£ ××©! <span class="g">${G.char.name}</span> ××¤×¡×™×“ 7 HP!`;
  }
  renderExercise();
}
function doNext(){
  G.chosen=null;G.showFb=false;
  if(G.exI+1>=G.exs.length){closeModal();G.pts+=120;showToast("ğŸ† ×¡×™×™××ª! +120 × ×§×•×“×•×ª ×‘×•× ×•×¡!","green");renderGame();}
  else{G.exI++;renderExercise();}
}
function closeModal(){document.getElementById("overlay").classList.remove("open");renderGame();}

function setShopCat(cat){
  G.shopCat=cat;
  document.querySelectorAll(".scat").forEach(b=>b.classList.remove("on"));
  document.getElementById("cat-"+cat).classList.add("on");
  renderShop();
}
function renderShop(){
  document.getElementById("shop-pts").textContent=`â­ ${G.pts.toLocaleString()}`;
  document.getElementById("shop-bal-num").textContent=G.pts.toLocaleString();
  document.getElementById("shop-grid").innerHTML=SHOP_DATA[G.shopCat].map(item=>{
    const isOwned=G.owned.includes(item.id),canAff=G.pts>=item.price;
    return `<div class="si"><span class="si-ic">${item.emoji}</span>
      <div class="si-nm">${item.name}</div><div class="si-ds">${item.desc}</div>
      <div class="si-pr">â­ ${item.price}</div>
      <button class="sib ${isOwned?'own':canAff?'can':'no'}" onclick="doBuy('${item.id}')" ${isOwned||!canAff?'disabled':''}>
        ${isOwned?"âœ“ ×‘×¨×©×•×ª×š":canAff?"×¨×›×•×©":"× ×§×•×“×•×ª ×œ× ××¡×¤×™×§×•×ª"}</button></div>`;
  }).join("");
}
function doBuy(id){
  const item=[...SHOP_DATA.skins,...SHOP_DATA.powers].find(x=>x.id===id);
  if(!item||G.owned.includes(id))return;
  if(G.pts<item.price){showToast("âŒ ××™×Ÿ ××¡×¤×™×§ × ×§×•×“×•×ª!","red");return;}
  G.pts-=item.price;G.owned.push(id);showToast(`âœ¨ "${item.name}" × ×¨×›×©!`,"green");renderShop();
}

function setAdminTab(tab){
  G.adminTab=tab;
  document.querySelectorAll(".at").forEach(b=>b.classList.remove("on"));
  document.getElementById("at-"+tab).classList.add("on");
  renderAdmin();
}
function renderAdmin(){
  const c=document.getElementById("admin-content");
  if(G.adminTab==="users"){
    c.innerHTML=`<div class="pnl"><div class="pnl-t tl">×¡×˜×˜×™×¡×˜×™×§×•×ª ×’×™×‘×•×¨×™×</div>
      <table class="dtable"><thead><tr><th>×©×</th><th>××™××™×™×œ</th><th>×“×§×³</th><th>××©×™××•×ª</th><th>× ×›×•×Ÿ</th><th>×“×™×•×§</th><th>× ×§×•×“×•×ª</th><th>×¤×¢×•×œ×•×ª</th></tr></thead>
      <tbody>${USERS.map(u=>`<tr>
        <td style="font-family:var(--S);font-weight:700;color:var(--gold)">${u.name}</td>
        <td style="color:var(--textD);font-size:11px">${u.email}</td>
        <td>${u.min}m</td><td>${u.tasks}</td><td style="color:var(--sageL)">${u.ok}</td>
        <td><span class="acc ${u.acc>=80?'hi':u.acc>=65?'md':'lo'}">${u.acc}%</span></td>
        <td style="color:var(--gold);font-family:var(--S)">â­ ${u.pts.toLocaleString()}</td>
        <td><button class="tbtn rs" onclick="showToast('ğŸ”„ × ×§×•×“×•×ª ××•×¤×¡×• ×¢×‘×•×¨ ${u.name}','red')">ğŸ”„ ××¤×¡</button>
            <button class="tbtn vw" onclick="showToast('ğŸ‘ï¸ ×¦×•×¤×” ×›-${u.name}')">ğŸ‘ ×ª×—×–×”</button></td>
      </tr>`).join("")}</tbody></table></div>`;
  }else if(G.adminTab==="tasks"){
    c.innerHTML=`<div class="pnl"><div class="pnl-t tl">××©×™××•×ª ×¤×¢×™×œ×•×ª</div>
      ${TASKS_DATA.map(t=>`<div class="trow">
        <span class="tyb ${t.type==='grammar'?'gr':'rd'}">${t.type==='grammar'?'×“×§×“×•×§':'×§×¨×™××”'}</span>
        <span class="tnm">${t.name}</span><span class="tmeta">${t.cnt} ×ª×¨×’×™×œ×™×</span><span class="tmeta">${t.date}</span>
      </div>`).join("")}</div>`;
  }else{
    c.innerHTML=`<div class="pnl"><div class="pnl-t tl">×™×¦×™×¨×ª ××©×™××” ×—×“×©×”</div>
      <div class="tskfm">
        <div class="fg"><label class="fl">×¡×•×’ ××©×™××”</label>
          <select class="fs"><option>×“×§×“×•×§ (Grammar)</option><option>×”×‘× ×ª ×”× ×§×¨× (Reading)</option></select></div>
        <div class="fg"><label class="fl">×©× ×”××©×™××”</label>
          <input class="fi" id="task-name" placeholder="×œ××©×œ: Present Perfect Tense"></div>
        <div class="fg"><label class="fl">×”×¢×œ×” ×—×•××¨ ×œ×™××•×“</label>
          <div class="fdrop" onclick="showToast('ğŸ“ ×›××Ÿ ×ª×•×›×œ×™ ×œ×’×¨×•×¨ ×§×‘×¦×™×')">ğŸ“ ×œ×—×¥/×™ ×œ×”×¢×œ××ª ×—×•××¨ ×œ×™××•×“</div></div>
        <div class="fg"><label class="fl">×”× ×—×™×•×ª ×œ×× ×•×¢ ×”-AI</label>
          <textarea class="fta" placeholder="×ª××¨/×™ ××” ×”×™×œ×“ ×œ×•××“ ×›×¢×ª..."></textarea></div>
        <button class="bteal" onclick="createTask()">âœ¨ ×™×™×¦×¨ 50 ×ª×¨×’×™×œ×™× ×¢× AI</button>
      </div>
      <div class="ainote">ğŸ¤– <strong>×× ×•×¢ ×”-AI ××•×›×Ÿ:</strong> Claude ×™×™×™×¦×¨ 50 ×ª×¨×’×™×œ×™× ××•×ª×××™× â€” 10 ×‘×›×œ ×¨××ª ×§×•×©×™.</div></div>`;
  }
}
function createTask(){
  const nm=document.getElementById("task-name")?.value;
  if(!nm){showToast("× × ×œ×”×–×™×Ÿ ×©× ××©×™××”","red");return;}
  showToast(`âœ… "${nm}" × ×•×¦×¨×” ×¢× 50 ×ª×¨×’×™×œ×™×!`,"green");
}
</script>
</body>
</html>
